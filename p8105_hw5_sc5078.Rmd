---
title: "p8105_hw5_sc5078"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(rvest)
library(ggplot2)
```

# Problem 2
## Start with a dataframe containing all file names
```{r}
file_name = list.files(path = "./data", all.files = FALSE, full.names = FALSE)
list(file_name)
```

## Iterate over file names, read in data, and tidy the result
```{r}
select_name <- function(x) {
  subject_ID_x = substr(x, 5,6)
  arm_x = substr(x, 1, 3)
  
  tibble(
    subject_ID = subject_ID_x, 
    arm = arm_x
  )
}

sep_name <- select_name(file_name)

file_paths <- c("./data/con_01.csv", "./data/con_02.csv", "./data/con_03.csv", "./data/con_04.csv", "./data/con_05.csv", "./data/con_06.csv", "./data/con_07.csv", "./data/con_08.csv", "./data/con_09.csv", "./data/con_10.csv", "./data/exp_01.csv", "./data/exp_02.csv", "./data/exp_03.csv", "./data/exp_04.csv", "./data/exp_05.csv", "./data/exp_06.csv", "./data/exp_07.csv", "./data/exp_08.csv", "./data/exp_09.csv", "./data/exp_10.csv")

read_data <- function(x) {
  data <- read.csv(x)  
  return(data)
}

hw5_data<- purrr::map(file_paths, read_data) |>
  bind_rows() |>
  bind_cols(x=_, y=sep_name) |>
  janitor::clean_names() |>
    pivot_longer(
      week_1:week_8,
      names_to = "week",
      names_prefix = "week_",
      values_to = "observation")
```

## Make a spaghetti plot showing observations on each subject over time
```{r}
hw5_data |>
  group_by(arm) |>
  ggplot(aes(x = week, y = observation, group = subject_id, color = subject_id)) +
  geom_line() +
  facet_wrap(~ arm) +
  labs(title = "Spaghetti Plot for Control and Experiment Group", x = "Week", y = "Observation") +
  theme_minimal()
```
According to the spaghetti plot of control group, there isn't a clear pattern of observation change over time. Specifically, the observation value in control group is relative stable among subjects over time. However, in the experiment group, subjects have a general increasing pattern of observation values over time.


# Problem 3
## Construct dataset
```{r}
set.seed(6)

sim_mean = function(mu, n = 30, sigma = 5, alpha = 0.05, sim = 5000) {
  results <- data.frame(mu = rep(mu, sim),
                        mu_hat = numeric(sim),
                        p_value = numeric(sim))
for (i in 1:sim) {
  x <- rnorm(n, mean = mu, sd = sigma)
  
  t_result <- broom::tidy(t.test(x))
  
  results$mu_hat[i] <- mean(x)
  results$p_value[i] <- t_result$p.value
} 
  results$power <- mean(results$p_value < alpha)
  
  return(results)
}

mu_values <- c(0,1,2,3,4,5,6)

combined_results <- data.frame()

for (mu in mu_values) {
  current_results <- sim_mean(mu)

  combined_results <- rbind(combined_results, current_results)
}
```

## Make a plot showing the power of the test vs. the true value of μ
```{r}
combined_results |>
  ggplot(aes(x = mu, y = power))+
  geom_point() +
  geom_line() +
  labs(title = "Power of test vs. the true value of μ", x = "True value of μ", y = "Power of test") +
  theme_minimal()

```

The general relationship between the power of test and the true value of μ is that the larger the effect size, the larger the power. Specifically, power increase faster between the true mean 0 to 4, and slow down when the true mean increase from 4 to 6.




